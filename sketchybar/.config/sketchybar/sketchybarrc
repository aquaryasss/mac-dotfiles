#!/bin/bash

source "$HOME/.config/sketchybar/colors.sh"

# Global Bar Settings
sketchybar --bar height=32 \
    position=top \
    color=$BAR_COLOR \
    margin=0 \
    y_offset=0 \
    sticky=on

# Default Item Settings
sketchybar --default updates=on \
    icon.font="sketchybar-app-font:Regular:16.0" \
    label.font="SF Pro:Semibold:14.0" \
    icon.color=$WHITE \
    label.color=$WHITE \
    padding_left=10 \
    padding_right=10 \
    icon.padding_right=4 \
    label.padding_left=4

# --- LEFT SIDE ---
# 1. Space Indicators (Minimalist Dots)
for i in {1..5}; do
    sketchybar --add space space.$i left \
        --set space.$i icon=$i \
        label.drawing=off \
        background.corner_radius=5 \
        background.height=20 \
        background.drawing=off \
        icon.color=$WHITE \
        click_script="yabai -m space --focus $i"
done

# 2. Front App (Shows what you're currently using)
sketchybar --add item front_app left \
    --set front_app icon.drawing=off \
    label.color=$PINK \
    script="sketchybar --set \$NAME label=\"\$(lsappinfo info -only name \$(lsappinfo front) | sed 's/\"//g' | awk -F= '{print \$2}')\"" \
    --subscribe front_app front_app_switched

sketchybar --add item app_counter left \
    --set app_counter icon=􀏦 \
    icon.color=$PINK \
    label.padding_left=4 \
    script="$CONFIG_DIR/items/app_counter.sh" \
    --subscribe app_counter window_created window_destroyed

# --- RIGHT SIDE ---
# Date
sketchybar --add item date right \
    --set date update_freq=3600 \
    icon=􀉉 icon.color=$PINK icon.padding_right=6 \
    label.padding_left=2 \
    script="$CONFIG_DIR/items/date.sh" \
    --subscribe date system_woke

# Clock
sketchybar --add item clock right \
    --set clock update_freq=10 \
    icon=􀐫 \
    icon.color=$PINK \
    icon.padding_right=6 \
    label.padding_left=2 \
    script="$CONFIG_DIR/items/clock.sh"

# Battery
sketchybar --add item battery right \
    --set battery update_freq=60 \
    icon=􀛨 \
    icon.color=$PINK \
    icon.padding_right=6 \
    label.padding_left=2 \
    script="$CONFIG_DIR/items/battery.sh" \
    --subscribe battery power_source_change system_woke

# CPU
sketchybar --add item cpu right \
    --set cpu update_freq=2 \
    icon=􀫥 icon.color=$PINK icon.padding_right=6 \
    label.padding_left=2 \
    script="sketchybar --set \$NAME label=\"$(top -l 2 | grep -E '^CPU' | tail -1 | awk '{print $3 + $5}')%\""

sketchybar --update
